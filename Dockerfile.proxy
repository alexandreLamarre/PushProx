FROM golang:1.22-alpine3.18 as builder
WORKDIR /usr/src/app
COPY . .
RUN make ci

FROM alpine:3.18.6
COPY --from=builder /usr/src/app/pushprox-proxy /usr/bin
CMD ["pushprox-proxy"]